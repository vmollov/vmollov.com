var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-38398614-1"]),_gaq.push(["_trackPageview"]),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),angular.module("vmMusic",["ngRoute","ngResource","ngSanitize","ngAnimate","ngTouch"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"templates/home.html",controller:"homeCtrl"}),a.when("/biography",{templateUrl:"templates/bio.html",controller:"bioCtrl"}),a.when("/calendar",{templateUrl:"templates/calendar.html",controller:"calendarCtrl"}),a.when("/recordings",{templateUrl:"templates/recordings.html",controller:"recordingsCtrl"}),a.when("/photos",{templateUrl:"templates/photos.html",controller:"photosCtrl"}),a.when("/videos",{templateUrl:"templates/videos.html",controller:"videosCtrl"}),a.when("/contact",{templateUrl:"templates/contact.html",controller:"contactCtrl"}),b.html5Mode(!0).hashPrefix("!")}]).constant("gCalUrl","https://www.googleapis.com/calendar/v3/calendars/5s80mf8pl7rtkj9bpasndqqe58%40group.calendar.google.com/events?maxResults=30&orderBy=startTime&singleEvents=true&key=AIzaSyDRrUkiIxPAi_OtunVrHRhvikL7d83cQsI"),angular.module("vmMusic").controller("bioCtrl",["$scope","$resource",function(a,b){a.bio=b("/data/bio").get()}]),angular.module("vmMusic").controller("calendarCtrl",["$scope","calendarData",function(a,b){b.getUpcomingEvents().then(function(b){a.upcomingEvents=b,a.upcommingEventOrderPredicate="startTime"},function(a){console.log("error retrieving upcoming events: "+a)}),b.getRecentEvents().then(function(b){a.recentEvents=b,a.recentEventOrderPredicate="-startTime"},function(a){console.log("error retrieving recent events: "+a)})}]),angular.module("vmMusic").controller("contactCtrl",["$scope","contactData",function(a,b){a.contact=b.getContactData()}]),angular.module("vmMusic").controller("footerCtrl",["$scope","contactData",function(a,b){a.about=b.getContactData()}]),angular.module("vmMusic").controller("headerCtrl",["$scope","$location",function(a,b){function c(){return"/"==b.$$path}function d(a,b,c){a.animate({opacity:0},200,function(){c.animate({height:b.height()},300,function(){b.css("display","inline"),b.animate({opacity:1}),a.css("display","none")})})}a.$watch(function(){return b.$$path},function(){c()?d($(".regularBanner"),$(".homeBanner"),$(".banner")):d($(".homeBanner"),$(".regularBanner"),$(".banner"))}),$(window).resize(function(){$(".banner").height(c()?$(".homeBanner").height():$(".regularBanner").height())}),a.displayFeatureEvent=c}]),angular.module("vmMusic").controller("homeCtrl",["$scope","$sce","welcomeData","newsData","featureData",function(a,b,c,d,e){c.getWelcomeMessage().then(function(c){a.welcomeMessage=b.trustAsHtml(c.welcome)},function(a){console.log("error fetching welcome message: "+a)}),a.news=d.getAllNewsItems(),a.newsOrderPredicate="-id",e.getFeatures().then(function(b){a.videoFeatures=b.video,a.audioFeatures=b.audio,a.featuresOrderPredicate="order"},function(a){console.log("error fetching features: "+a)})}]),angular.module("vmMusic").controller("photosCtrl",["$scope","photosData",function(a,b){function c(){var a=function(){for(var a=0,b=$("ul.nav>li>img"),c=0;g>c;c++)a+=b[c].width+10;return a}();$(".thumbSlider .nav").animate({marginLeft:-a},400)}function d(){return{low:Math.floor(.25*e())+1,high:Math.floor(.75*e())-1}}function e(){var b=f/a.photos.length;return $(".thumbSlider").width()/b}a.photos=[],b.getAllImages().then(function(b){a.photos[0]=b[0];for(var c=1;c<b.length;c++){for(var d=!1,e=0;e<a.photos.length;e++)if(b[c].dateupload>=a.photos[e].dateupload){a.photos.splice(e,0,b[c]),d=!0;break}d||a.photos.push(b[c])}a.photo=a.photos[0]});var f=0,g=0,h=0;a.getThumbsWidth=function(){return{width:f+"px"}},a.updateThumbViewWidth=function(a){f+=a.width()+15},a.isActive=function(a){return h===a},a.updateSlideCaptionWidth=function(){},a.showPrev=function(){var b=h>0?h-1:a.photos.length-1;a.showPhoto(b)},a.showNext=function(){var b=h<a.photos.length-1?h+1:0;a.showPhoto(b)},a.showPhoto=function(b){for(h=b,a.photo=a.photos[b],b==a.photos.length-1&&(g=b-d().high);g<b-d().high&&b<a.photos.length-1;)g++;for(;g>b-d().low&&g>0;)g--;c()},a.imageCounter=function(){return h+1+"/"+a.photos.length},a.thumbViewNext=function(){return g>a.photos.length-d().high?void(g=a.photos.length-d().high):(g+=2,void c())},a.thumbViewPrevious=function(){0!=g&&(g-=2,c())},$(document).keydown(function(b){37==b.keyCode&&a.showPrev(),39==b.keyCode&&a.showNext(),a.$apply()}),a.thumbViewSwipeAdvance=function(b){b?g++:g--,b?a.thumbViewNext():a.thumbViewPrevious()}}]),angular.module("vmMusic").controller("recordingsCtrl",["$scope","recordingsData",function(a,b){b.getAllRecordings().then(function(b){a.recordings=b,a.recordingsOrderPredicate="order"})}]),angular.module("vmMusic").controller("videosCtrl",["$scope","videosData",function(a,b){b.getYouTubeVideos().then(function(c){a.allVideos=b.sanitizeYouTubeVideos(c.feed.entry)},function(a){console.log("error fetching videos: "+a)})}]),angular.module("vmMusic").directive("audioPlayer",["audioManager",function(a){return{restrict:"E",replace:!0,templateUrl:"/templates/directives/audioPlayer.html",scope:{},controller:["$scope","$rootScope",function(b,c){function d(){f(),clearTimeout(h),$("#mpegSource").attr("src","/audio/"+b.audioSrc+".mp3"),$("#oggSource").attr("src","/audio/"+b.audioSrc+".ogg"),j.load().get(0).play()}function e(){j.get(0).pause(),h=setTimeout(g,1500)}function f(){k||(i.css({display:"block"}),i.animate({bottom:1},700,function(){k=!0}))}function g(){j.get(0).paused&&i.animate({bottom:"-100%"},700,function(){k=!1,i.css({display:"none"})})}var h,i=$("#audioPlayerContainer"),j=$("#audioPlayer"),k=!1;b.btnPlayStatus=function(){return j.get(0).paused?"/img/site/btnPlay_audio.png":"/img/site/btnPause_audio.png"},b.togglePlay=function(){j.get(0).paused?d():e()},b.volume=.75,b.changeVolume=function(){j.get(0).volume=b.volume},b.timeIndicator="0:00",j.bind("timeupdate",function(){var a=Math.round(this.currentTime/60%1*60);10>a&&(a="0"+a);var c=Math.floor(this.currentTime/3600%1*60);10>c&&(c="0"+c),b.timeIndicator=c+":"+a,b.$apply()}),b.$on("playAudioStartRequestEvent",function(a,c){b.audioTitle=c.title,b.audioSrc=c.src,d()}),b.$on("playAudioStopRequestEvent",e),j.bind("pause",function(){a.setCurrentlyPlayingAudio(""),c.$broadcast("playAudioGlobalStopRequestEvent"),e()}),j.bind("play",function(){a.setCurrentlyPlayingAudio(b.audioSrc),c.$broadcast("playAudioGlobalStartRequestEvent",{src:b.audioSrc})}),j.bind("ended",function(){b.timeIndicator="00:00",b.$apply()})}]}}]),angular.module("vmMusic").directive("audioSample",["audioManager",function(a){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"/templates/directives/audioSample.html",scope:{src:"=",songTitle:"="},controller:["$scope","$rootScope",function(b,c){function d(a){b.btnPlay.status="play"==a?e.playing:e.paused}var e={playing:"/img/site/btnPause_audio.png",paused:"/img/site/btnPlay_audio.png"};b.btnPlay={},b.btnPlay.status=a.getCurrentlyPlayingAudio()==b.src?e.playing:e.paused,b.togglePlayPaused=function(){b.btnPlay.status==e.paused?b.playAudio():b.pauseAudio()},b.playAudio=function(){d("play"),c.$broadcast("playAudioStartRequestEvent",{src:b.src,title:b.songTitle})},b.pauseAudio=function(){d("pause"),c.$broadcast("playAudioStopRequestEvent")},b.$on("playAudioGlobalStopRequestEvent",function(){d("pause"),b.$apply()}),b.$on("playAudioGlobalStartRequestEvent",function(a,c){d(c.src==b.src?"play":"pause"),b.$apply()})}]}}]),angular.module("vmMusic").directive("calendarEvent",function(){return{restrict:"E",replace:!0,templateUrl:"/templates/directives/calendarEvent.html",scope:{event:"="}}}),angular.module("vmMusic").directive("featureEvent",["calendarData",function(a){return{restrict:"E",replace:!0,templateUrl:"/templates/directives/featureEvent.html",scope:{display:"="},controller:["$scope",function(b){function c(){return b.display?void 0==b.event?void(30>f&&setTimeout(c,500)):void(e=setTimeout(function(){$("#hEvent").toggleClass("displayControl",!0),$("#hEvent").animate({opacity:1},700)},1800)):void 0}function d(){clearTimeout(e),$("#hEvent").animate({opacity:0},400,function(){$("#hEvent").toggleClass("displayControl",!1)})}a.getNextEvent().then(function(a){b.event=a}),b.$watch("display",function(){b.display?c():d()});var e,f=0}]}}]),angular.module("vmMusic").directive("onLoad",function(){return{restrict:"A",replace:!1,link:function(a,b){b.bind("load",function(){a.$apply(a.callback(b))})},scope:{callback:"="}}}),angular.module("vmMusic").directive("navigation",function(){return{restrict:"E",replace:!0,templateUrl:"/templates/directives/navigation.html",scope:{},controller:["$scope","$location",function(a,b){a.currentPage=function(){return"/"==b.$$path?"":" - "+b.$$path.substr(1).toUpperCase()},$("li.hasSub").on("mouseleave",function(){$("li.hasSub").toggleClass("hover",!1)}),$("#close").on("touchstart",function(){$("li.hasSub").off("mouseover")}),$("li.hasSub").on("click",function(){$("li.hasSub").toggleClass("hover")}),$(".menuTitle").on("click",function(){$("nav > ul li:not(.menuTitle)").toggleClass("menuItemOn"),$(".menuItemOn:not(.hasSub)").off("click"),$(".menuItemOn:not(.hasSub)").on("click",function(){$("nav > ul li:not(.menuTitle)").toggleClass("menuItemOn",!1)})})}]}}),angular.module("vmMusic").directive("videoSample",function(){return{restrict:"E",replace:!0,templateUrl:"/templates/directives/videoSample.html",scope:{videoSrc:"=",videoTitle:"=",videoThumbnail:"="},controller:["$scope","$rootScope",function(a,b){function c(){if($("#videoPlayerContainer").length>0)return void $("#videoPlayerContainer iframe").attr("src",a.videoSrc);var b=$("<div id='videoPlayerContainer'></div>"),c=$("<div class='closeOverlay'><a href='#' class='closeButton'>close<img src='/img/site/btnPopupClose.png'/></a></div>"),e=$("<iframe width='"+.8*window.innerWidth+"' height='"+.8*window.innerHeight+"' src='"+a.videoSrc+"' frameborder='0' allowfullscreen></iframe>");b.append(c),b.append(e),$("body").append(b),b.animate({top:"10%"},700),$("#videoPlayerContainer .closeButton").on("click",d),$("#videoPlayerContainer").on("click",function(a){a.stopPropagation()}),$("html").on("click",d),$(document).keyup(function(a){27==a.which&&d()})}function d(){$("#videoPlayerContainer").animate({top:"100%"},700,function(){$("#videoPlayerContainer").remove()}),$("#videoPlayerContainer .closeButton").off("click",d)}a.playVideo=function(){b.$broadcast("playAudioStopRequestEvent"),c()},b.$on("playAudioGlobalStartRequestEvent",d),$(".videoLink").on("click",function(a){a.stopPropagation()})}]}}),angular.module("vmMusic").filter("timeZone",function(){return function(a){return null!=a&&a.length>16?a.substring(0,16):a}}),angular.module("vmMusic").filter("toTrusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("vmMusic").factory("audioManager",function(){var a;return{getCurrentlyPlayingAudio:function(){return a},setCurrentlyPlayingAudio:function(b){a=b}}}),angular.module("vmMusic").factory("calendarData",["$http","$q","gCalUrl",function(a,b,c){function d(a,b){for(var c=[],d=0;d<a.length;d++){var f=e(a[d]),g=new Date(f.startTime);(g>new Date&&b||g<new Date&&!b)&&c.push(f)}return c}function e(a){return{title:a.summary,startTime:a.start.dateTime,location:a.location,description:a.description}}var f=b.defer();a({method:"GET",url:c}).success(function(a){f.resolve(a.items)}).error(function(a){console.log("An error occured while getting calendar events. "+a)});var g=f.promise.then(function(a){return d(a,!0)}),h=f.promise.then(function(a){return d(a,!1)}),i=f.promise.then(function(a){for(var b,c=0;c<a.length;c++){var d=e(a[c]),f=new Date(d.startTime);f>new Date&&(void 0==b||f<new Date(b.startTime))&&(b=d)}return b});return{getUpcomingEvents:function(){return g},getRecentEvents:function(){return h},getNextEvent:function(){return i}}}]),angular.module("vmMusic").factory("contactData",["$resource",function(a){var b=a("/data/about");return{getContactData:function(){return b.get()}}}]),angular.module("vmMusic").factory("featureData",["$http","$q",function(a,b){return{getFeatures:function(){var c=b.defer();return a({method:"GET",url:"/data/features"}).success(function(a){c.resolve(a)}),c.promise}}}]),angular.module("vmMusic").factory("newsData",["$resource",function(a){var b=a("/data/news");return{getAllNewsItems:function(){return b.query()}}}]),angular.module("vmMusic").factory("photosData",["$http","$q",function(a){function b(a){return"https://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key="+e+"&photo_id="+a+"&format=json&nojsoncallback=1"}function c(a){for(var b=a.data.photoset.photo,c=0;c<b.length;c++)d(b[c]);return b}function d(c){a({method:"GET",url:b(c.id)}).then(function(a){c.source=function(a){for(var b={},c=0;c<a.length;c++)"Square"==a[c].label&&(b.thumbnail=a[c].source),"Medium"==a[c].label&&(b.medium=a[c].source),"Original"==a[c].label&&(b.original=a[c].source);return b}(a.data.sizes.size)})}var e="48dad8a586fe5931b1db3c1026e0564b",f="https://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key="+e+"&photoset_id=72157645114741942&extras=date_upload&format=json&nojsoncallback=1",g=a({method:"GET",url:f}).then(c);return{getAllImages:function(){return g}}}]),angular.module("vmMusic").factory("recordingsData",["$http","$q",function(a,b){return{getAllRecordings:function(){var c=b.defer();return a({method:"GET",url:"/data/recordings"}).success(function(a){c.resolve(a)}),c.promise}}}]),angular.module("vmMusic").factory("videosData",["$http","$q",function(a,b){function c(a){for(var b=0;b<j.length;b++)if(a.indexOf(j[b])>-1)return!0;return!1}function d(a){var b=a.media$group.media$content[0].url;return b.replace(/\/v\//,"/embed/")+"&autoplay=1"}function e(a){return a.media$group.media$title.$t}function f(a){return a.media$group.media$thumbnail[1].url}function g(a){return a.media$group.media$description.$t}var h="Vladimir Mollov",i=18,j=["iUL7wOzp698","FDFBDw97Epg","tbQHOigF8WA","WuZE2vidsIM","U9Tb3HWkJRE"];i+=j.length;var h=h.replace(/ +/,"/"),k="http://gdata.youtube.com/feeds/api/videos/-/"+h+"?max-results="+i+"&alt=json&orderby=published";return{getYouTubeVideos:function(){var c=b.defer();return a({method:"GET",url:k}).success(function(a){c.resolve(a)}),c.promise},sanitizeYouTubeVideos:function(a){for(var b=0;b<a.length;b++)c(a[b].id.$t)&&a.splice(b,1);for(var h=[],b=0;b<a.length;b++)h.push({embedUrl:d(a[b]),title:e(a[b]),thumbnail:f(a[b]),description:g(a[b])});return h}}}]),angular.module("vmMusic").factory("welcomeData",["$http","$q",function(a,b){var c=b.defer();return{getWelcomeMessage:function(){return a({method:"GET",url:"data/welcome"}).success(function(a){c.resolve(a)}),c.promise}}}]);